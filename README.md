# Music API
Это REST API для работы с музыкальной библиотекой, реализующее функциональность:

- Получение списка песен с фильтрацией по группе и названию, а также с поддержкой пагинации.
- Получение текста песни с пагинацией по куплетам.
- Добавление новой песни.
- Обновление данных песни.
- Удаление песни.
- При добавлении новой песни API отправляет запрос к внешнему сервису (описанному в Swagger) для получения обогащённых данных (дата релиза, текст и ссылка). По умолчанию этот запрос отключён (функция fetchSongDetails закомментирована) и используется генерация локальных данных. Для включения интеграции достаточно раскомментировать вызов в функции CreateSong в файле internal/service.go.

## Технологии
- Go (backend)
- PostgreSQL (БД)
- Goose – для миграций базы данных
- Chi – для роутинга
- Swaggo – для генерации Swagger документации
- godotenv – для работы с переменными окружения

## Структура проекта

``` 
testForWork/
├── cmd/
│   └── main.go         // Точка входа в приложение
├── internal/
│   ├── api/            // Реализация REST API (роутеры, обработчики)
│   ├── config/         // Конфигурация приложения, загрузка .env
│   ├── database/       // Подключение к PostgreSQL и миграции
│   ├── models/         // Модели данных
│   └── service/        // Бизнес-логика приложения
├── database/
│   └── migrations/     // SQL-скрипты миграций (goose)
├── .env                // Конфигурационные переменные
└── README.md           // Этот файл
```

## Установка и запуск
### Предварительные требования
- Go (версия 1.16+)
- PostgreSQL
- Установленный Goose (не обязательно, так как миграции выполняются программно)

### Шаг 1. Клонирование репозитория

```
git clone https://github.com/your_username/testForWork.git
cd testForWork
```
### Шаг 2. Настройка переменных окружения
Создайте файл .env (если его ещё нет) и настройте параметры:

```
PORT=8080
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=admin
DB_NAME=music_db
MUSIC_API=http://localhost:8081
```
Значение MUSIC_API – URL для вызова внешнего API, который возвращает данные для обогащения песни.

### Шаг 3. Запуск приложения
Соберите и запустите приложение:
```
go run cmd/main.go
```
Приложение запустится на порту, указанном в файле .env (по умолчанию 8080). При старте будут применены миграции для создания таблицы songs в базе данных.

### Использование API
#### Swagger Документация
Документация по API генерируется автоматически с использованием комментариев. Доступна по адресу:


```
http://localhost:8080/swagger/index.html
```
#### Примеры эндпоинтов
- Получение песен с фильтрацией и пагинацией:
``` 
GET /songs?group=Muse&song_name=Black&page=1&limit=10
```

- Получение текста песни с пагинацией по куплетам:
```
GET /songs/{id}/lyrics?page=1&limit=3
```

- Добавление новой песни:
```
POST /songs
```
Тело запроса (JSON):

```json
{
"group": "Muse",
"song": "Supermassive Black Hole"
}
```

Примечание: По умолчанию при добавлении используется генерация локальных данных. Для обращения к внешнему API необходимо раскомментировать вызов функции fetchSongDetails в internal/service.go.

- Обновление песни:
```
PUT /songs/{id} 
```
с передачей JSON с изменениями.

- Удаление песни:
```
DELETE /songs/{id}
```

## Замечания по интеграции с внешним API
В соответствии с ТЗ необходимо получать обогащённые данные о песне из внешнего API. В реализации присутствует функция fetchSongDetails, которая выполняет запрос к API (Swagger-документация доступна по указанному URL). По умолчанию этот вызов закомментирован для удобства тестирования. Если Вам требуется реальная интеграция, достаточно раскомментировать соответствующий участок кода.

## База данных
База данных создаётся и настраивается автоматически при старте приложения посредством миграционных скриптов, расположенных в `database/migrations`.

## Логирование
Приложение использует логирование (debug и info) для отслеживания важных событий, таких как стартап сервера, подключение к базе данных и выполнение CRUD-операций.

## Заключение
Этот проект реализует все требования тестового задания. Если у вас возникнут вопросы или потребуется дополнительная информация по настройке/запуску, пожалуйста, свяжитесь со мной.